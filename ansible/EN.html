<!DOCTYPE html>
<html lang=EN>
    <head>
        <title> ansible Refcard</title>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/default.min.css">
        <link rel='stylesheet' href='../css/refcards-style.css'>
        <script async defer src="https://buttons.github.io/buttons.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.8/ScrollMagic.min.js"></script>
    </head>
    <body>
    <div class="first-page" style="background-color: #2e4995">
        <div class="buttons">
            <a href="../index.html">
                <img src="../assets/back-logo.svg" alt="fleche retour">
            </a>
            <a href="https://github.com/ineat/refcards/discussions/new" class="hide_mobile">Une erreur ? Une question ? Éditer cette page sur Github</a>
            <a class="github-button" href="https://github.com/ineat/refcards" data-color-scheme="no-preference: light; light: light; dark: dark;" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star ineat/refcards on GitHub">Star</a>
            <div class="internationalization">
        <img src="../assets/EN.png" alt="EN flag">
            <select onchange="location= this.value">
                <option selected>EN</option>
                <option value="FR.html">FR</option>
            </select>
    </div>
        </div>
        <img src="" alt="">
        <div class="band">
            <img src="assets/logo-ansible.png" alt="logo ansible">
            <img src="../assets/ineat-logo.svg" alt="logo ineat">
        </div>
        <a href="https://github.com/ineat/refcards">
            <img src="../assets/github_fabbutton.svg" alt="logo github" id="github">
        </a>
    </div>
    <div class="buttons-on-page">
        <a href="../index.html">
            <img src="../assets/back-logo-black.svg" alt="fleche retour">
        </a>
        <a href="https://github.com/ineat/refcards/discussions/new" class="hide_mobile">Une erreur ? Une question ? Éditer cette page sur Github</a>
        <a class="github-button" href="https://github.com/ineat/refcards" data-color-scheme="no-preference: light; light: light; dark: dark;" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star ineat/refcards on GitHub">Star</a>
        <div class="little-menu">
            <img src="assets/logo-ansible.png" alt="logo ansible">
        </div>
        <div class="internationalization">
        <img src="../assets/EN.png" alt="EN flag">
            <select onchange="location= this.value">
                <option selected>EN</option>
                <option value="FR.html">FR</option>
            </select>
    </div>
    </div>
        <h1 class="heading1" style="color: #2e4995" id="ansible-refcard"><a class="anchor" href="#ansible-refcard"><img src="../assets/anchor.svg" alt></a>Ansible RefCard</h1><p><em>English version</em></p>
<p>RefCard for Ansible usage.</p>
<p>Written by Germain LEFEBVRE on December 2018 for Ansible v2.7 usage.</p>
<p><strong>Table of Contents</strong></p>
<ol>
<li><a class="links" style="color :#2e4995" href="#context" title="">Context</a></li>
<li><a class="links" style="color :#2e4995" href="#upgrade-your-ansible-version" title="">Upgrade your Ansible version</a></li>
<li><a class="links" style="color :#2e4995" href="#ansible-definitions" title="">Ansible Definitions</a></li>
<li><a class="links" style="color :#2e4995" href="#ansible-configuration" title="">Ansible Configuration</a></li>
<li><a class="links" style="color :#2e4995" href="#ansible-adhoc-commands" title="">Ansible AdHoc Commands</a></li>
<li><a class="links" style="color :#2e4995" href="#ansible-inventories" title="">Ansible Inventories</a></li>
<li><a class="links" style="color :#2e4995" href="#ansible-tasks" title="">Ansible Tasks</a></li>
<li><a class="links" style="color :#2e4995" href="#ansible-playbooks" title="">Ansible Playbooks</a></li>
<li><a class="links" style="color :#2e4995" href="#ansible-variables" title="">Ansible Variables</a></li>
<li><a class="links" style="color :#2e4995" href="#ansible-plays" title="">Ansible Plays</a></li>
<li><a class="links" style="color :#2e4995" href="#ansible-roles" title="">Ansible Roles</a></li>
<li><a class="links" style="color :#2e4995" href="#ansible-modules" title="">Ansible Modules</a></li>
<li><a class="links" style="color :#2e4995" href="#ansible-vault" title="">Ansible Vault</a></li>
</ol>
<h3 class="heading3" style="color: #2e4995" id="context"><a class="anchor" href="#context"><img src="../assets/anchor.svg" alt></a>Context</h3><p>This is the list of the packages version used to make this RefCard.</p>
<p>Operating System distribution and version:</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77">cat /etc/redhat-release</code></pre><pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77">CentOS Linux release 7.5.1804 (Core)</code></pre><p>Python version:</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77">python --version</code></pre><pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77">Python 2.7.5</code></pre><p>Ansible version:</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77">ansible --version</code></pre><pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77">ansible 2.7.1
  config file = /etc/ansible/ansible.cfg
  configured module search path = [u&#x27;/home/ansible/.ansible/plugins/modules&#x27;, u&#x27;/usr/share/ansible/plugins/modules&#x27;]
  ansible python module location = /usr/lib/python2.7/site-packages/ansible
  executable location = /bin/ansible
  python version = 2.7.5 (default, Apr 11 2018, 07:36:10) [GCC 4.8.5 20150623 (Red Hat 4.8.5-28)]</code></pre></div>

                        <div class="h2-part" id="div-upgrade-your-ansible-version">

                            <h2 class="heading2" style="color: #2e4995"><a class="anchor" href="#upgrade-your-ansible-version"><img src="../assets/anchor.svg" alt></a>Upgrade your Ansible version</h2>

                            <div class="title-menu-container"><p class="title-menu" id="upgrade-your-ansible-version">Upgrade your Ansible version</p></div>
<p>Ansible give their Roadmap for v2.7 : <a class="links" style="color :#2e4995" href="https://docs.ansible.com/ansible/2.7/roadmap/ROADMAP_2_7.html" title="">https://docs.ansible.com/ansible/2.7/roadmap/ROADMAP_2_7.html</a></p>
<p>Ansible provides porting guides to help you keeping up-to-date:</p>
<ul>
<li><a class="links" style="color :#2e4995" href="https://docs.ansible.com/ansible/2.7/porting_guides/porting_guide_2.0.html" title="">Ansible 2.0 Porting Guide</a></li>
<li><a class="links" style="color :#2e4995" href="https://docs.ansible.com/ansible/2.7/porting_guides/porting_guide_2.3.html" title="">Ansible 2.3 Porting Guide</a></li>
<li><a class="links" style="color :#2e4995" href="https://docs.ansible.com/ansible/2.7/porting_guides/porting_guide_2.4.html" title="">Ansible 2.4 Porting Guide</a></li>
<li><a class="links" style="color :#2e4995" href="https://docs.ansible.com/ansible/2.7/porting_guides/porting_guide_2.5.html" title="">Ansible 2.5 Porting Guide</a></li>
<li><a class="links" style="color :#2e4995" href="https://docs.ansible.com/ansible/2.7/porting_guides/porting_guide_2.6.html" title="">Ansible 2.6 Porting Guide</a></li>
<li><a class="links" style="color :#2e4995" href="https://docs.ansible.com/ansible/2.7/porting_guides/porting_guide_2.7.html" title="">Ansible 2.7 Porting Guide</a></li>
</ul>
</div>

                        <div class="h2-part" id="div-ansible-definitions">

                            <h2 class="heading2" style="color: #2e4995"><a class="anchor" href="#ansible-definitions"><img src="../assets/anchor.svg" alt></a>Ansible Definitions</h2>

                            <div class="title-menu-container"><p class="title-menu" id="ansible-definitions">Ansible Definitions</p></div>
<h3 class="heading3" style="color: #2e4995" id="ansible-facts"><a class="anchor" href="#ansible-facts"><img src="../assets/anchor.svg" alt></a>Ansible Facts</h3><p>The Facts are variables used by Ansible to persist data through hosts and executions. There are native facts are stored on local server (disk or in-memory) and user facts defined by Human actions. It is important to get that facts are stored by group of actions OR by host.</p>
<h3 class="heading3" style="color: #2e4995" id="ansible-hosts"><a class="anchor" href="#ansible-hosts"><img src="../assets/anchor.svg" alt></a>Ansible Hosts</h3><p>The Hosts are just servers that the Ansible Server can reach trhough its preferred protocol.</p>
<h3 class="heading3" style="color: #2e4995" id="ansible-inventories"><a class="anchor" href="#ansible-inventories"><img src="../assets/anchor.svg" alt></a>Ansible Inventories</h3><p>The Inventories are list of Hosts defined by FQDN and tidied in groups. Groups can be composed with hosts or group of hosts. Hosts can be aliased to make the list customisable.</p>
<h3 class="heading3" style="color: #2e4995" id="ansible-tasks"><a class="anchor" href="#ansible-tasks"><img src="../assets/anchor.svg" alt></a>Ansible Tasks</h3><p>The Tasks are the actions launched on remote Hosts. Tasks are written in YAML langage in a descriptive structure way making the read and write uniform through any tasks in the world.</p>
<h3 class="heading3" style="color: #2e4995" id="ansible-variables"><a class="anchor" href="#ansible-variables"><img src="../assets/anchor.svg" alt></a>Ansible Variables</h3><p>The Variables are the way for Ansible to pass custom values in tasks (and more over).</p>
<h3 class="heading3" style="color: #2e4995" id="ansible-playbooks"><a class="anchor" href="#ansible-playbooks"><img src="../assets/anchor.svg" alt></a>Ansible Playbooks</h3><p>The Playbooks are the gathering of tasks and hosts. So a Playbook defines a list of tasks to perform on remote servers.</p>
<h3 class="heading3" style="color: #2e4995" id="ansible-roles"><a class="anchor" href="#ansible-roles"><img src="../assets/anchor.svg" alt></a>Ansible Roles</h3><p>The Roles are the tidy way to write playbooks. It permits to store a group of actions with the same purpose and to call them in playbooks in a single line.</p>
<h3 class="heading3" style="color: #2e4995" id="ansible-handlers"><a class="anchor" href="#ansible-handlers"><img src="../assets/anchor.svg" alt></a>Ansible Handlers</h3><p>Ansible Handlers are action triggers called from tasks and run at the end of a play. A Handler is a tasks defined by its name and called with its name.</p>
<h3 class="heading3" style="color: #2e4995" id="ansible-modules"><a class="anchor" href="#ansible-modules"><img src="../assets/anchor.svg" alt></a>Ansible Modules</h3><p>Modules are scripts written in Python and making uniform actions possible in giving common inputs for users and generating outputs regarding the command played in the module.</p>
</div>

                        <div class="h2-part" id="div-ansible-configuration">

                            <h2 class="heading2" style="color: #2e4995"><a class="anchor" href="#ansible-configuration"><img src="../assets/anchor.svg" alt></a>Ansible Configuration</h2>

                            <div class="title-menu-container"><p class="title-menu" id="ansible-configuration">Ansible Configuration</p></div>
<p>Configuration can be made and used in a file which will be searched for in the following order:</p>
<ul>
<li>ansible.cfg (in the current directory)</li>
<li>~/.ansible.cfg (in the home directory)</li>
<li>/etc/ansible/ansible.cfg</li>
</ul>
</div>

                        <div class="h2-part" id="div-ansible-adhoc-commands">

                            <h2 class="heading2" style="color: #2e4995"><a class="anchor" href="#ansible-adhoc-commands"><img src="../assets/anchor.svg" alt></a>Ansible AdHoc Commands</h2>

                            <div class="title-menu-container"><p class="title-menu" id="ansible-adhoc-commands">Ansible AdHoc Commands</p></div>
<p>AdHoc commands are commands launched on the fly with writting any complex structured files.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77">ansible localhost -m ping
ansible localhost -m setup
ansible localhost -m debug -a <span class="hljs-string">&#x27;myVar&#x27;</span>
ansible localhost -m shell -a <span class="hljs-string">&#x27;uptime&#x27;</span>
ansible all -i inventories/servers -m ping</code></pre></div>

                        <div class="h2-part" id="div-ansible-inventories-1">

                            <h2 class="heading2" style="color: #2e4995"><a class="anchor" href="#ansible-inventories-1"><img src="../assets/anchor.svg" alt></a>Ansible Inventories</h2>

                            <div class="title-menu-container"><p class="title-menu" id="ansible-inventories-1">Ansible Inventories</p></div>
<p>Ansible Inventories make possible to gather servers in a single file to run commands on all these hosts. Inventories are usually organized by environments (a file by env) to let the group_vars operate on tasks and roles.</p>
<p>Inventory definition:</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-string">server.domain.fr</span>
<span class="hljs-string">server[01-09].domain.fr</span>

<span class="hljs-string">rhel01</span> <span class="hljs-string">rhel01.domain.fr</span>
<span class="hljs-string">deb01</span> <span class="hljs-string">deb01.domain.fr</span>
<span class="hljs-string">arch01</span> <span class="hljs-string">arch01.domain.fr</span>
<span class="hljs-string">win01</span> <span class="hljs-string">win01.domain.fr</span>

[<span class="hljs-string">redhat</span>]
<span class="hljs-string">rhel01</span>

[<span class="hljs-string">debian</span>]
<span class="hljs-string">deb01</span>

[<span class="hljs-string">linux:children</span>]
<span class="hljs-string">redhat</span>
<span class="hljs-string">debian</span>

[<span class="hljs-string">linux</span>]
<span class="hljs-string">arch01</span>

[<span class="hljs-string">windows</span>]
<span class="hljs-string">win01</span></code></pre></div>

                        <div class="h2-part" id="div-ansible-tasks-1">

                            <h2 class="heading2" style="color: #2e4995"><a class="anchor" href="#ansible-tasks-1"><img src="../assets/anchor.svg" alt></a>Ansible Tasks</h2>

                            <div class="title-menu-container"><p class="title-menu" id="ansible-tasks-1">Ansible Tasks</p></div>
<p>A task is a YAML structure able to perform actions through Ansible.</p>
<p>Task definition :</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">The</span> <span class="hljs-string">task</span> <span class="hljs-string">name</span> <span class="hljs-string">to</span> <span class="hljs-string">make</span> <span class="hljs-string">things</span> <span class="hljs-string">clearly</span>
  <span class="hljs-attr">become:</span> <span class="hljs-literal">yes</span>
  <span class="hljs-attr">become_method:</span> <span class="hljs-string">sudo</span>
  <span class="hljs-attr">become_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">check_mode:</span> <span class="hljs-literal">yes</span>
  <span class="hljs-attr">diff:</span> <span class="hljs-literal">no</span>
  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">ansible</span>
  <span class="hljs-attr">ignore_errors:</span> <span class="hljs-literal">True</span>
  <span class="hljs-attr">import_tasks:</span> <span class="hljs-string">more_handlers</span>
  <span class="hljs-attr">include_tasks:</span> <span class="hljs-string">other-tasks.yml</span>
  <span class="hljs-attr">notify:</span> <span class="hljs-string">restart</span> <span class="hljs-string">apache</span>
  <span class="hljs-attr">register:</span> <span class="hljs-string">my_register</span>
  <span class="hljs-attr">changed_when:</span> <span class="hljs-literal">False</span>
  <span class="hljs-attr">failed_when:</span> <span class="hljs-literal">False</span>
  <span class="hljs-attr">vars:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">myvar:</span> <span class="hljs-string">toto</span>
    <span class="hljs-attr">myfiles:</span>
      <span class="hljs-bullet">-</span>  <span class="hljs-string">default.conf</span>
  <span class="hljs-attr">loop:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">item1</span>
    <span class="hljs-bullet">-</span> [<span class="hljs-string">&quot;item2&quot;</span>, <span class="hljs-string">&quot;item3&quot;</span>]
    <span class="hljs-bullet">-</span> { <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;item4&quot;</span>, <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Desc Item 4&quot;</span> }
  <span class="hljs-attr">when:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">my_register</span> <span class="hljs-string">is</span> <span class="hljs-string">defined</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">ansible_distribution</span> <span class="hljs-string">==</span> <span class="hljs-string">&quot;CentOS&quot;</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">ansible_distribution_major_version</span> <span class="hljs-string">==</span> <span class="hljs-string">&quot;7&quot;</span> 
  <span class="hljs-attr">block:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Task</span> <span class="hljs-string">to</span> <span class="hljs-string">run</span> <span class="hljs-string">in</span> <span class="hljs-string">block</span>
      <span class="hljs-string">...</span>
  <span class="hljs-attr">rescue:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Task</span> <span class="hljs-string">when</span> <span class="hljs-string">block</span> <span class="hljs-string">failed</span>
  <span class="hljs-attr">always:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Task</span> <span class="hljs-string">always</span> <span class="hljs-string">run</span> <span class="hljs-string">before/after</span> <span class="hljs-string">block</span></code></pre></div>

                        <div class="h2-part" id="div-ansible-playbooks-1">

                            <h2 class="heading2" style="color: #2e4995"><a class="anchor" href="#ansible-playbooks-1"><img src="../assets/anchor.svg" alt></a>Ansible Playbooks</h2>

                            <div class="title-menu-container"><p class="title-menu" id="ansible-playbooks-1">Ansible Playbooks</p></div>
<p>A playbook is the gathering between hosts where will be applied tasks.</p>
<p><strong>Install package on RHEL servers</strong></p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> [<span class="hljs-string">redhat</span>]
  <span class="hljs-attr">become:</span> <span class="hljs-literal">true</span>
  <span class="hljs-string">tasks</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">yum:</span>
      <span class="hljs-attr">name:</span> <span class="hljs-string">httpd</span>
      <span class="hljs-attr">state:</span> <span class="hljs-string">installed</span></code></pre><p><strong>Run roles on Docker servers but Master</strong></p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">docker,!docker-master</span>
  <span class="hljs-attr">become:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">roles:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">docker</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">kubernetes</span></code></pre></div>

                        <div class="h2-part" id="div-ansible-variables-1">

                            <h2 class="heading2" style="color: #2e4995"><a class="anchor" href="#ansible-variables-1"><img src="../assets/anchor.svg" alt></a>Ansible Variables</h2>

                            <div class="title-menu-container"><p class="title-menu" id="ansible-variables-1">Ansible Variables</p></div>
<h3 class="heading3" style="color: #2e4995" id="variable-definition"><a class="anchor" href="#variable-definition"><img src="../assets/anchor.svg" alt></a>Variable Definition</h3><p>A Ansible variable is defined in <em>group_vars</em>, <em>host_vars</em>, <em>role vars</em>, <em>CLI vars</em> and is called in Jinja Templating way : <code class="codespan" style="color: #2e4995">{{ my_variable }}</code>. You can call variables everywhere in Ansible (tasks, variables, template, ...)</p>
<h3 class="heading3" style="color: #2e4995" id="variable-typology"><a class="anchor" href="#variable-typology"><img src="../assets/anchor.svg" alt></a>Variable Typology</h3><p>You can have 3 types of variables:</p>
<ul>
<li>String</li>
<li>List</li>
<li>Dictionary</li>
</ul>
<p>A variable is defined by a couple Key/Value where Key doesn&#39;t have any space and Value is a structure as defined above.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-attr">my_string:</span> <span class="hljs-string">&quot;value&quot;</span>
<span class="hljs-attr">my_list:</span> [<span class="hljs-string">&quot;bob&quot;</span>, <span class="hljs-string">&quot;alice&quot;</span>]
<span class="hljs-attr">my_dict:</span>
    <span class="hljs-attr">item1:</span> <span class="hljs-string">value1</span>
    <span class="hljs-attr">item2:</span> <span class="hljs-string">value2</span></code></pre><h3 class="heading3" style="color: #2e4995" id="variable-precedence"><a class="anchor" href="#variable-precedence"><img src="../assets/anchor.svg" alt></a>Variable precedence</h3><p>You can set Ansible variables in multiple places like <code class="codespan" style="color: #2e4995">group_vars</code>, <code class="codespan" style="color: #2e4995">playbooks</code>, <code class="codespan" style="color: #2e4995">roles</code>, etc... but they are evaluated according to a precedence. Here is the order of precedence from least to greatest:</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77">command line values
role defaults
inventory file or script group vars
inventory group_vars/all
playbook group_vars/all
inventory group_vars/*
playbook group_vars/*
inventory file or script host vars
inventory host_vars/*
playbook host_vars/*
host facts / cached set_facts
play vars
play vars_prompt
play vars_files
role vars (defined in role/vars/main.yml)
block vars (only for tasks in block)
task vars (only for the task)
include_vars
set_facts / registered vars
role (and include_role) params
include params
extra vars (always win precedence)</code></pre></div>

                        <div class="h2-part" id="div-ansible-plays">

                            <h2 class="heading2" style="color: #2e4995"><a class="anchor" href="#ansible-plays"><img src="../assets/anchor.svg" alt></a>Ansible Plays</h2>

                            <div class="title-menu-container"><p class="title-menu" id="ansible-plays">Ansible Plays</p></div>
<p>A sufficient list of attributes for Ansible Play when running a playbook:</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">webservers</span>
  <span class="hljs-attr">accelerate:</span> <span class="hljs-literal">no</span>
  <span class="hljs-attr">accelerate_port:</span> <span class="hljs-number">5099</span>
  <span class="hljs-attr">ansible_connection:</span> <span class="hljs-string">local</span>
  <span class="hljs-attr">any_errors_fatal:</span> <span class="hljs-literal">True</span>
  <span class="hljs-attr">become:</span> <span class="hljs-literal">yes</span>
  <span class="hljs-attr">become_method:</span> <span class="hljs-string">su</span>
  <span class="hljs-attr">become_user:</span> <span class="hljs-string">postgress</span>
  <span class="hljs-attr">become_flags:</span> <span class="hljs-literal">True</span>
  <span class="hljs-attr">debugger:</span> <span class="hljs-string">on_failed</span>
  <span class="hljs-attr">gather_facts:</span> <span class="hljs-literal">no</span>
  <span class="hljs-attr">max_fail_percentage:</span> <span class="hljs-number">30</span>
  <span class="hljs-attr">order:</span> <span class="hljs-string">sorted</span>
  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">serial:</span> <span class="hljs-number">5</span>
  <span class="hljs-attr">strategy:</span> <span class="hljs-string">debug</span>
  <span class="hljs-attr">vars:</span>
    <span class="hljs-attr">http_port:</span> <span class="hljs-number">80</span>
  <span class="hljs-attr">vars_files:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;vars.yml&quot;</span>
  <span class="hljs-attr">vars_prompt:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;my_password2&quot;</span>
      <span class="hljs-attr">prompt:</span> <span class="hljs-string">&quot;Enter password2&quot;</span>
      <span class="hljs-attr">default:</span> <span class="hljs-string">&quot;secret&quot;</span>
      <span class="hljs-attr">private:</span> <span class="hljs-literal">yes</span>
      <span class="hljs-attr">encrypt:</span> <span class="hljs-string">&quot;md5_crypt&quot;</span>
      <span class="hljs-attr">confirm:</span> <span class="hljs-literal">yes</span>
      <span class="hljs-attr">salt:</span> <span class="hljs-number">1234</span>
      <span class="hljs-attr">salt_size:</span> <span class="hljs-number">8</span>
  <span class="hljs-attr">tags:</span> 
    <span class="hljs-bullet">-</span> <span class="hljs-string">stuff</span>
  <span class="hljs-attr">pre_tasks:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">&lt;task&gt;</span>
  <span class="hljs-attr">roles:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">common</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">common</span>
      <span class="hljs-attr">vars:</span>
        <span class="hljs-attr">port:</span> <span class="hljs-number">5000</span>
      <span class="hljs-attr">when:</span> <span class="hljs-string">&quot;bar == &#x27;Baz&#x27;&quot;</span>
      <span class="hljs-attr">tags :</span> [<span class="hljs-string">one</span>, <span class="hljs-string">two</span>]
    <span class="hljs-bullet">-</span> <span class="hljs-string">common</span>
    <span class="hljs-bullet">-</span> { <span class="hljs-attr">role:</span> <span class="hljs-string">common</span>, <span class="hljs-attr">port:</span> <span class="hljs-number">5000</span>, <span class="hljs-attr">when:</span> <span class="hljs-string">&quot;bar == &#x27;Baz&#x27;&quot;</span>, <span class="hljs-string">tags</span> <span class="hljs-string">:</span>[<span class="hljs-string">one</span>, <span class="hljs-string">two</span>] }
  <span class="hljs-attr">tasks:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">include:</span> <span class="hljs-string">tasks.yaml</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">include:</span> <span class="hljs-string">tasks.yaml</span>
      <span class="hljs-attr">when:</span> <span class="hljs-string">day</span> <span class="hljs-string">==</span> <span class="hljs-string">&#x27;Thursday&#x27;</span>
      <span class="hljs-attr">vars:</span>
        <span class="hljs-attr">foo:</span> <span class="hljs-string">aaa</span> 
        <span class="hljs-attr">baz:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">z</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">y</span>
    <span class="hljs-bullet">-</span> { <span class="hljs-attr">include:</span> <span class="hljs-string">tasks.yaml</span>, <span class="hljs-attr">foo:</span> <span class="hljs-string">zzz</span>, <span class="hljs-attr">baz:</span> [<span class="hljs-string">a</span>,<span class="hljs-string">b</span>]}
    <span class="hljs-bullet">-</span> <span class="hljs-string">&lt;task&gt;</span>
  <span class="hljs-attr">post_tasks:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">&lt;task&gt;</span></code></pre></div>

                        <div class="h2-part" id="div-ansible-roles-1">

                            <h2 class="heading2" style="color: #2e4995"><a class="anchor" href="#ansible-roles-1"><img src="../assets/anchor.svg" alt></a>Ansible Roles</h2>

                            <div class="title-menu-container"><p class="title-menu" id="ansible-roles-1">Ansible Roles</p></div>
<h3 class="heading3" style="color: #2e4995" id="structure-of-a-role"><a class="anchor" href="#structure-of-a-role"><img src="../assets/anchor.svg" alt></a>Structure of a role</h3><p>Role directories strucutre:</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77">roles/
└── my-role
    ├── defaults
    │   └── main.yml
    ├── files
    |   └── file
    ├── handlers
    │   └── main.yml
    ├── tasks
    │   └── main.yml
    ├── templates
    |   └── template.j2
    └── vars
        └── main.yml</code></pre><p>These are what files refer to:</p>
<ul>
<li><code class="codespan" style="color: #2e4995">my-role/defaults/main.yml</code> defines default variables for the role,</li>
<li><code class="codespan" style="color: #2e4995">my-role/files/file</code> file (without vars) to be copied,</li>
<li><code class="codespan" style="color: #2e4995">my-role/handlers/main.yml</code> defnies the handlers tasks,</li>
<li><code class="codespan" style="color: #2e4995">my-role/tasks/main.yml</code> is the main taskfile run thorugh the role,</li>
<li><code class="codespan" style="color: #2e4995">my-role/templates/template.yml.j2</code> template (with vars) to be copied,</li>
<li><code class="codespan" style="color: #2e4995">my-role/vars/main.yml</code> defines the vars to override,</li>
</ul>
<h4 class="heading4" style="color: #2e4995" id="role-with-simple-task"><a class="anchor" href="#role-with-simple-task"><img src="../assets/anchor.svg" alt></a>Role with simple task</h4><pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-bullet">-</span> <span class="hljs-attr">command:</span> <span class="hljs-string">cat</span> <span class="hljs-string">/etc/hosts</span></code></pre><h4 class="heading4" style="color: #2e4995" id="role-with-file-to-copy"><a class="anchor" href="#role-with-file-to-copy"><img src="../assets/anchor.svg" alt></a>Role with file to copy</h4><p>File at <code class="codespan" style="color: #2e4995">roles/example/files/my-file.sh</code> and task at <code class="codespan" style="color: #2e4995">roles/example/tasks/main.yml</code>.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-bullet">-</span> <span class="hljs-attr">copy:</span>
    <span class="hljs-attr">src:</span> <span class="hljs-string">my-file.sh</span>
    <span class="hljs-attr">dest:</span> <span class="hljs-string">/tmp/my-file.sh</span></code></pre><h4 class="heading4" style="color: #2e4995" id="role-with-template-to-generate"><a class="anchor" href="#role-with-template-to-generate"><img src="../assets/anchor.svg" alt></a>Role with template to generate</h4><p>Template at <code class="codespan" style="color: #2e4995">roles/example/templates/my-template.sh.j2</code></p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;{{ timezone }}&quot;</span></code></pre><p>Task at <code class="codespan" style="color: #2e4995">roles/example/tasks/main.yml</code></p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-bullet">-</span> <span class="hljs-attr">template:</span>
    <span class="hljs-attr">src:</span> <span class="hljs-string">my-template.sh.j2</span>
    <span class="hljs-attr">dest:</span> <span class="hljs-string">/tmp/my-template.sh</span></code></pre><h4 class="heading4" style="color: #2e4995" id="role-with-trigger-to-handler"><a class="anchor" href="#role-with-trigger-to-handler"><img src="../assets/anchor.svg" alt></a>Role with trigger to handler</h4><p>Handler at <code class="codespan" style="color: #2e4995">roles/example/handlers/main.yml</code>.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Restart</span> <span class="hljs-string">Apache</span>
  <span class="hljs-attr">systemd:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">httpd</span>
    <span class="hljs-attr">state:</span> <span class="hljs-string">restart</span></code></pre><p>Task at <code class="codespan" style="color: #2e4995">roles/example/tasks/main.yml</code>.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-bullet">-</span> <span class="hljs-attr">copy:</span>
    <span class="hljs-attr">src:</span> <span class="hljs-string">httpd.conf</span>
    <span class="hljs-attr">dest:</span> <span class="hljs-string">/etc/httpd/conf/httpd.conf</span>
  <span class="hljs-attr">notify:</span> <span class="hljs-string">Restart</span> <span class="hljs-string">Apache</span></code></pre><p>Will run the handler <code class="codespan" style="color: #2e4995">Restart Apache</code> if task <code class="codespan" style="color: #2e4995">copy</code> state has changed.</p>
<h4 class="heading4" style="color: #2e4995" id="role-with-default-variables"><a class="anchor" href="#role-with-default-variables"><img src="../assets/anchor.svg" alt></a>Role with default variables</h4><p>Default variables at <code class="codespan" style="color: #2e4995">roles/example/defaults/main.yml</code></p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-attr">apache_version:</span> <span class="hljs-string">&#x27;2.4.2&#x27;</span></code></pre><p>Task at <code class="codespan" style="color: #2e4995">roles/example/tasks/main.yml</code></p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-bullet">-</span> <span class="hljs-attr">yum:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">httpd-{{</span> <span class="hljs-string">apache_version</span> <span class="hljs-string">}}</span>
    <span class="hljs-attr">state:</span> <span class="hljs-string">present</span></code></pre></div>

                        <div class="h2-part" id="div-including-and-importing-playbooks-or-tasks-or-roles">

                            <h2 class="heading2" style="color: #2e4995"><a class="anchor" href="#including-and-importing-playbooks-or-tasks-or-roles"><img src="../assets/anchor.svg" alt></a>Including and importing playbooks or tasks or roles</h2>

                            <div class="title-menu-container"><p class="title-menu" id="including-and-importing-playbooks-or-tasks-or-roles">Including and importing playbooks or tasks or roles</p></div>
<h3 class="heading3" style="color: #2e4995" id="include-tasks"><a class="anchor" href="#include-tasks"><img src="../assets/anchor.svg" alt></a>Include tasks</h3><p>Both <code class="codespan" style="color: #2e4995">import_task</code> and <code class="codespan" style="color: #2e4995">include_task</code> work.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> [<span class="hljs-string">redhat</span>]
  <span class="hljs-attr">tasks:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">import_tasks:</span> <span class="hljs-string">roles/example/tasks/main.yml</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">include_tasks:</span> <span class="hljs-string">roles/example/tasks/main.yml</span></code></pre><h3 class="heading3" style="color: #2e4995" id="include-tasks-but-filter-on-tag-in-ansible-playbook-command"><a class="anchor" href="#include-tasks-but-filter-on-tag-in-ansible-playbook-command"><img src="../assets/anchor.svg" alt></a>Include tasks but filter on tag in ansible-playbook command</h3><p>Only <code class="codespan" style="color: #2e4995">import_tasks</code> works and evaluates tags from tasks.</p>
<h3 class="heading3" style="color: #2e4995" id="include-playbook"><a class="anchor" href="#include-playbook"><img src="../assets/anchor.svg" alt></a>Include playbook</h3><p>Only <code class="codespan" style="color: #2e4995">import_playbook</code> works for including a whole playbook in another one.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-bullet">-</span> <span class="hljs-attr">import_playbook:</span> <span class="hljs-string">install_apache.yml</span></code></pre><h3 class="heading3" style="color: #2e4995" id="include-a-whole-role"><a class="anchor" href="#include-a-whole-role"><img src="../assets/anchor.svg" alt></a>Include a whole role</h3><p>Both <code class="codespan" style="color: #2e4995">import_role</code> and <code class="codespan" style="color: #2e4995">include_role</code> can be used to call tasks from a role. This will include the whole role <code class="codespan" style="color: #2e4995">example</code>.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> [<span class="hljs-string">redhat</span>]
  <span class="hljs-attr">tasks:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">import_role:</span>
      <span class="hljs-attr">name:</span> <span class="hljs-string">example</span></code></pre><h3 class="heading3" style="color: #2e4995" id="include-a-taskfile-from-a-role"><a class="anchor" href="#include-a-taskfile-from-a-role"><img src="../assets/anchor.svg" alt></a>Include a taskfile from a role</h3><p>Permit to load all variables inherant to the role. This will include the task <code class="codespan" style="color: #2e4995">install.yml</code>from the role <code class="codespan" style="color: #2e4995">example</code>.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> [<span class="hljs-string">redhat</span>]
  <span class="hljs-attr">tasks:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">include_role:</span>
      <span class="hljs-attr">name:</span> <span class="hljs-string">example</span>
      <span class="hljs-attr">tasks_from:</span> <span class="hljs-string">install</span></code></pre><h3 class="heading3" style="color: #2e4995" id="include-tasks-but-filter-on-tag-in-ansible-playbook-command-1"><a class="anchor" href="#include-tasks-but-filter-on-tag-in-ansible-playbook-command-1"><img src="../assets/anchor.svg" alt></a>Include tasks but filter on tag in ansible-playbook command</h3><p>Only <code class="codespan" style="color: #2e4995">import_role</code> works for including a whole role in a playbook using tags on commands.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> [<span class="hljs-string">redhat</span>]
  <span class="hljs-attr">tasks:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">import_role:</span>
      <span class="hljs-attr">name:</span> <span class="hljs-string">example</span></code></pre></div>

                        <div class="h2-part" id="div-ansible-options">

                            <h2 class="heading2" style="color: #2e4995"><a class="anchor" href="#ansible-options"><img src="../assets/anchor.svg" alt></a>Ansible Options</h2>

                            <div class="title-menu-container"><p class="title-menu" id="ansible-options">Ansible Options</p></div>
<p>Ansible offre des possibilités plus avancées qui aident à la vérification, au débuggage et poussent sur le plan non destructif des exécutions.</p>
<h3 class="heading3" style="color: #2e4995" id="filter-with-inventory"><a class="anchor" href="#filter-with-inventory"><img src="../assets/anchor.svg" alt></a>Filter with Inventory</h3><p>Option <code class="codespan" style="color: #2e4995">--limit</code> or <code class="codespan" style="color: #2e4995">-l</code> filters playbook runtime by server (host or alias), inventory groups and understand the exclusions.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77">ansible-playbook -i hosts.yml playbook.yml --limit &#x27;linux,!debian&#x27;</code></pre><h3 class="heading3" style="color: #2e4995" id="filter-by-tag"><a class="anchor" href="#filter-by-tag"><img src="../assets/anchor.svg" alt></a>Filter by Tag</h3><p>Option <code class="codespan" style="color: #2e4995">--tag</code> or <code class="codespan" style="color: #2e4995">-t</code> filters playbook tasks on tags set through attribut <code class="codespan" style="color: #2e4995">tags:</code> on Plays and Tasks. Exclusion is possible on Tag filter.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77">ansible-playbook -i host.yml playbook.yml --tags &#x27;config,service,!reload&#x27;</code></pre><h3 class="heading3" style="color: #2e4995" id="run-in-dry-run"><a class="anchor" href="#run-in-dry-run"><img src="../assets/anchor.svg" alt></a>Run in Dry-Run</h3><p>Option <code class="codespan" style="color: #2e4995">--check</code> runs playbook without applying any modification on server and reveals the state for every Task (ok, changed, failed). Dry-Run mode make verifications easy.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77">ansible-playbook -i host.yml playbook.yml --check</code></pre><p>Dry-Run mode is not plenty compatible with shell module because no state is returned on running shell scripts or commands.</p>
<h3 class="heading3" style="color: #2e4995" id="mode-differences"><a class="anchor" href="#mode-differences"><img src="../assets/anchor.svg" alt></a>Mode Differences</h3><p>Option <code class="codespan" style="color: #2e4995">--diff</code> show differences between Ansible and Server sides and is closely linked to files (copy, template modules). Differences mode is a good way to see changes on servers.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77">ansible-playbook -i host.yml playbook.yml --diff</code></pre></div>

                        <div class="h2-part" id="div-ansible-modules-1">

                            <h2 class="heading2" style="color: #2e4995"><a class="anchor" href="#ansible-modules-1"><img src="../assets/anchor.svg" alt></a>Ansible Modules</h2>

                            <div class="title-menu-container"><p class="title-menu" id="ansible-modules-1">Ansible Modules</p></div>
<h3 class="heading3" style="color: #2e4995" id="location"><a class="anchor" href="#location"><img src="../assets/anchor.svg" alt></a>Location</h3><p>Store your modules on :</p>
<ul>
<li>Local side (current dir) : Create your Ansibel Module directly in your ansible rundir in a directory <code class="codespan" style="color: #2e4995">library</code>,</li>
<li>Server side (all users) : Define the path with the attribute <code class="codespan" style="color: #2e4995">library</code> in <code class="codespan" style="color: #2e4995">/etc/ansible/ansible.cfg</code>.<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-attr">library</span>        = /usr/share/my_modules/</code></pre></li>
</ul>
<h3 class="heading3" style="color: #2e4995" id="instanciate-your-module-class"><a class="anchor" href="#instanciate-your-module-class"><img src="../assets/anchor.svg" alt></a>Instanciate your Module Class</h3><pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAnsibleModule</span>(<span class="hljs-params">AnsibleModule</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span>
        self._output = []
        self._facts = <span class="hljs-built_in">dict</span>()
        <span class="hljs-built_in">super</span>(MyAnsibleModule, self).__init__(*args, **kwargs)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process</span>(<span class="hljs-params">self</span>):</span>
        [...]</code></pre><h3 class="heading3" style="color: #2e4995" id="run-your-class"><a class="anchor" href="#run-your-class"><img src="../assets/anchor.svg" alt></a>Run your Class</h3><pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:
  MyAnsibleModule().process()</code></pre><h3 class="heading3" style="color: #2e4995" id="define-your-attributes"><a class="anchor" href="#define-your-attributes"><img src="../assets/anchor.svg" alt></a>Define your attributes</h3><p>Define your module arguments.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77">MyAnsibleModule(
    argument_spec=<span class="hljs-built_in">dict</span>(
        url=<span class="hljs-built_in">dict</span>(<span class="hljs-built_in">type</span>=<span class="hljs-string">&#x27;str&#x27;</span>,
                 required=<span class="hljs-literal">True</span>),
        <span class="hljs-built_in">type</span>=<span class="hljs-built_in">dict</span>(<span class="hljs-built_in">type</span>=<span class="hljs-string">&#x27;str&#x27;</span>,
                  required=<span class="hljs-literal">True</span>,
                  choices=[<span class="hljs-string">&#x27;indice&#x27;</span>, <span class="hljs-string">&#x27;document&#x27;</span>]),
        state=<span class="hljs-built_in">dict</span>(<span class="hljs-built_in">type</span>=<span class="hljs-string">&#x27;str&#x27;</span>,
                   choices=[<span class="hljs-string">&#x27;present&#x27;</span>,<span class="hljs-string">&#x27;absent&#x27;</span>],
                   default=<span class="hljs-string">&#x27;present&#x27;</span>)
    )
).process()</code></pre><p>Call your module argument on processing.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-keyword">try</span>:
        changed = <span class="hljs-literal">False</span>

        <span class="hljs-comment"># Retrieve value for attribute &#x27;url&#x27;</span>
        param_url = self.params[<span class="hljs-string">&#x27;url&#x27;</span>]

        self.exit_json(changed=changed, ansible_facts={}, output=self._output)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        self.fail_json(msg=(e.message, self._output))</code></pre><h3 class="heading3" style="color: #2e4995" id="use-the-check-mode"><a class="anchor" href="#use-the-check-mode"><img src="../assets/anchor.svg" alt></a>Use the Check Mode</h3><p>Enable the check mode.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>
    MyAnsibleModule(
        supports_check_mode=<span class="hljs-literal">True</span>,
        [...]
    ).process()</code></pre><p>Use the check mode in processing. Process to your action after checking check_mode statement.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># Stop if check_mode is true before doing any action</span>
    <span class="hljs-keyword">if</span> self.check_mode:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    <span class="hljs-comment"># Keep doing actions if check_mode is false</span></code></pre></div>

                        <div class="h2-part" id="div-ansible-vault">

                            <h2 class="heading2" style="color: #2e4995"><a class="anchor" href="#ansible-vault"><img src="../assets/anchor.svg" alt></a>Ansible Vault</h2>

                            <div class="title-menu-container"><p class="title-menu" id="ansible-vault">Ansible Vault</p></div>
<h3 class="heading3" style="color: #2e4995" id="vault-configuration"><a class="anchor" href="#vault-configuration"><img src="../assets/anchor.svg" alt></a>Vault Configuration</h3><p>Ansible Vault Password configuration can be done in several ways:</p>
<ul>
<li>Attribute <code class="codespan" style="color: #2e4995">vault_password_file</code> in file <code class="codespan" style="color: #2e4995">ansible.cfg</code>,</li>
<li>Env variable <code class="codespan" style="color: #2e4995">ANSIBLE_VAULT_PASSWORD_FILE</code>,</li>
<li>Option <code class="codespan" style="color: #2e4995">--vault-password-file</code> or <code class="codespan" style="color: #2e4995">--vault-id</code> with password file in ansible command,</li>
<li>Option <code class="codespan" style="color: #2e4995">--ask-vault-pass</code> with prompt in ansible command.</li>
</ul>
<h3 class="heading3" style="color: #2e4995" id="vault-file"><a class="anchor" href="#vault-file"><img src="../assets/anchor.svg" alt></a>Vault File</h3><p>You can secure whole files with vault in encrypting them.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77">ansible-vault create foo.yml
ansible-vault encrypt foo.yml</code></pre><p>View and decrypt to clear file.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77">ansible-vault view foo.yml
ansible-vault encrypt foo.yml</code></pre><h3 class="heading3" style="color: #2e4995" id="vault-variables"><a class="anchor" href="#vault-variables"><img src="../assets/anchor.svg" alt></a>Vault Variables</h3><p>You can also only encrypt value in variables files.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77">ansible-vault encrypt_string --name &#x27;mykey&#x27; &#x27;mysecret&#x27;</code></pre><h3 class="heading3" style="color: #2e4995" id="ansible-with-vault"><a class="anchor" href="#ansible-with-vault"><img src="../assets/anchor.svg" alt></a>Ansible with Vault</h3><p>If you have provided a vault password in configuration file then you will keep using ansible as usual.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77"></code></pre><p>If not you will need to provide vault options to your ansible commands.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77">ansible-playbook site.yml --ask-vault-pass
ansible-playbook site.yml --vault-password-file ~/.vault_pass
ansible-playbook --vault-id dev@dfile-dev-password site.yml
ansible-playbook --vault-id prod@prompt site.yml</code></pre><p>You can also provide multiple vault resolvers to roll on multiple environments. Example for Dev with password file and Prod with prompt.</p>
<pre style="background-color: #fef2e1"><code class="code" style="color: #2e2b77">ansible-playbook --vault-id dev@dev-password --vault-id prod@prompt site.yml</code></pre>
        </div>
        <script defer src="../script/SceneCreator.js"></script>
    </body>
</html>
